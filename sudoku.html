<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Sudoku ‚Äî –ø—Ä–æ—Ç–æ—Ç–∏–ø</title>
  <style>
    :root{
      --bg:#0f1724; --card:#0b1220; --accent:#7dd3fc; --muted:#94a3b8; --cell:#0b1220;
      --size:480px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;min-height:100vh;display:flex;align-items:center;justify-content:center;
      background:linear-gradient(180deg,#071028 0%,#031022 100%);
      font-family:Inter,Segoe UI,Roboto,'Helvetica Neue',Arial;color:#e6eef6
    }
    .app{
      width:calc(var(--size)+280px);max-width:95vw;
      background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);
      border-radius:14px;padding:20px;display:flex;gap:20px;
      box-shadow:0 10px 30px rgba(2,6,23,0.6)
    }
	.back-to-menu-button {
            position: fixed;
            top: 20px;
            left: 20px;
            background: linear-gradient(45deg, #ff6b6b, #ee5a52);
            color: white;
            border: none;
            padding: 12px 20px;
            border-radius: 50px;
            font-size: 1.1rem;
            font-weight: bold;
            font-family: 'Comic Sans MS', cursive, Arial, sans-serif;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(255,107,107,0.3);
            z-index: 1000;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .back-to-menu-button:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(255,107,107,0.4);
        }
    .panel{width:260px}
    h1{font-size:18px;margin:0 0 12px}
    label{display:block;font-size:13px;color:var(--muted);margin:12px 0 6px}
    select,input[type=range]{width:100%}
    button{
      width:100%;padding:10px;border-radius:8px;border:none;background:var(--accent);
      color:#022;cursor:pointer;font-weight:600
    }
    .board-wrap{
      background:linear-gradient(180deg,rgba(255,255,255,0.02),transparent);
      padding:18px;border-radius:10px;display:flex;align-items:center;justify-content:center;
      flex-direction: column;
    }
    .board{
      display:grid;gap:3px;background:transparent;
    }
    .cell{
      width:calc(var(--size)/var(--n));height:calc(var(--size)/var(--n));
      display:flex;align-items:center;justify-content:center;border-radius:6px;
      font-size:calc((var(--size)/var(--n))*0.66); /* 2/3 —Ä–∞–∑–º–µ—Ä–∞ –∫–ª–µ—Ç–∫–∏ */
      user-select:none;
    }
    .cell.fixed{
      background:#07182a;color:#cfeffd;font-weight:700
    }
    .cell.empty{
      background:rgba(255,255,255,0.02);cursor:pointer
    }
    .cell.note{
      font-size:10px;line-height:1
    }
    .controls{
      display:flex;gap:8px;margin-top:12px
    }
    .small{
      font-size:13px;padding:8px
    }
    .footer{
      font-size:12px;color:var(--muted);margin-top:12px
    }
    .top-line{
      display:flex;align-items:center;justify-content:space-between;margin-bottom:12px
    }
    .message {
      margin-top: 10px;
      color: var(--accent);
      font-weight: 600;
      font-size: 16px;
      text-align: center;
    }
    .new-game-btn {
      margin-top: 8px;
      width: 150px;
      align-self: center;
    }
  </style>
</head>
<body>
  <div class="app">
    <div class="panel">
      <div class="top-line">
        <h1>Sudoku ‚Äî –ø—Ä–æ—Ç–æ—Ç–∏–ø</h1>
      </div>

      <label>–†–∞–∑–º–µ—Ä –ø–æ–ª—è (N x N)</label>
      <select id="sizeSelect">
        <option value="2">2 x 2 (–º–∏–Ω–∏)</option>
        <option value="3">3 x 3</option>
        <option value="4">4 x 4</option>
        <option value="5">5 x 5</option>
        <option value="6">6 x 6</option>
        <option value="7">7 x 7</option>
        <option value="8">8 x 8</option>
        <option value="9" selected>9 x 9</option>
        <option value="10">10 x 10</option>
      </select>

      <label>–°–ª–æ–∂–Ω–æ—Å—Ç—å (—á–µ–º –≤—ã—à–µ ‚Äî –±–æ–ª—å—à–µ –ø—É—Å—Ç—ã—Ö)</label>
      <input id="difficulty" type="range" min="1" max="5" value="2" />

      <label>–°–∏–º–≤–æ–ª—ã –¥–ª—è –º–∞–ª—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤</label>
      <select id="symbolMode">
        <option value="numbers">–ß–∏—Å–ª–∞</option>
        <option value="fruits" selected>–§—Ä—É–∫—Ç—ã / –æ–≤–æ—â–∏ (2-5)</option>
      </select>

      <div class="controls">
        <button id="newBtn" class="small">–ù–æ–≤–∞—è</button>
        <button id="solveBtn" class="small">–†–µ—à–∏—Ç—å</button>
      </div>

      <div class="footer">–ü—Ä–æ—Ç–æ—Ç–∏–ø –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ä–∞–∑–º–µ—Ä—ã –ø–æ–ª—è –æ—Ç 2√ó2 –¥–æ 10√ó10. –ú–∞–ª—ã–µ –ø–æ–ª—è (2-5) –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç —ç–º–æ–¥–∑–∏ –≤–º–µ—Å—Ç–æ —á–∏—Å–µ–ª.</div>
    </div>
	<button class="back-to-menu-button" onclick="goBackToMenu()">
        üè† –ù–∞–∑–∞–¥ –∫ –º–µ–Ω—é
    </button>
    <div class="board-wrap">
      <div id="boardContainer"></div>
      <div id="messageContainer" class="message"></div>
      <button id="newGameAfterWin" class="new-game-btn" style="display:none;">–ù–æ–≤–∞—è –∏–≥—Ä–∞</button>
    </div>
	<div id="rules" style="margin-top:20px; font-size:1.2em; text-align:center; max-width:600px; margin-left:auto; margin-right:auto; line-height:1.4;">
    <b>–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã –°—É–¥–æ–∫—É: –í –∫–∞–∂–¥–æ–π —Å—Ç—Ä–æ–∫–µ –∏ —Å—Ç–æ–ª–±—Ü–µ –≤—Å–µ —Ü–∏—Ñ—Ä—ã (—Ñ—Ä—É–∫—Ç—ã) –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —Ä–∞–∑–Ω—ã–º–∏.</b><br>
    
</div>
  </div>

  <script>
    const fruits = ['üçé','üçä','üçê','üçá','üçì','üçâ','üçå','ü•ù','üçç','ü•ï'];
	const params = new URLSearchParams(window.location.search);
const paramSize = Number(params.get('size'));     // –æ–∂–∏–¥–∞–µ–º 2..10
const paramMode = params.get('mode');             // 'fruits' | 'numbers'

// 2) –°–°–´–õ–ö–ò –ù–ê –≠–õ–ï–ú–ï–ù–¢–´ –£–ü–†–ê–í–õ–ï–ù–ò–Ø (–ö–ê–ö –í –ü–ï–†–í–û–ô –í–ï–†–°–ò–ò)
const sizeSelect   = document.getElementById('sizeSelect');
const difficulty   = document.getElementById('difficulty');
const symbolMode   = document.getElementById('symbolMode');
    const newBtn = document.getElementById('newBtn');
    const solveBtn = document.getElementById('solveBtn');
    const boardContainer = document.getElementById('boardContainer');
    const messageContainer = document.getElementById('messageContainer');
    const newGameAfterWin = document.getElementById('newGameAfterWin');

    let N = 9;
    let board = [];
    let solution = [];
	if (Number.isFinite(paramSize)) {
  // –æ–≥—Ä–∞–Ω–∏—á–∏–º –¥–∏–∞–ø–∞–∑–æ–Ω –∏ –≤—ã—Å—Ç–∞–≤–∏–º –∑–Ω–∞—á–µ–Ω–∏–µ —Å–µ–ª–µ–∫—Ç–æ—Ä–∞
  const clamped = Math.min(10, Math.max(2, paramSize));
  sizeSelect.value = String(clamped);
}
if (paramMode === 'fruits' || paramMode === 'numbers') {
  symbolMode.value = paramMode;
}
if (params.has('size') || params.has('mode')) {
   document.querySelector('.panel')?.style.setProperty('display','none');
 }
	function goBackToMenu() {
            window.location.href = 'index.html'; // –ó–∞–º–µ–Ω–∏—Ç–µ –Ω–∞ –∏–º—è —Ñ–∞–π–ª–∞ –≤–∞—à–µ–≥–æ –º–µ–Ω—é
        }
    function makeEmpty(n){return Array.from({length:n},()=>Array(n).fill(0));}

    function blockShape(n){
      for(let r=Math.floor(Math.sqrt(n));r>=1;r--){
        if(n%r===0){
          return [r, n/r];
        }
      }
      return [1,n];
    }

    function isSafe(grid,row,col,val){
      for(let i=0;i<N;i++) if(grid[row][i]===val) return false;
      for(let i=0;i<N;i++) if(grid[i][col]===val) return false;
      const [br, bc] = blockShape(N);
      const startRow = Math.floor(row/br)*br;
      const startCol = Math.floor(col/bc)*bc;
      for(let r=0;r<br;r++) for(let c=0;c<bc;c++) if(grid[startRow+r][startCol+c]===val) return false;
      return true;
    }

    function shuffle(arr){for(let i=arr.length-1;i>0;i--){const j=Math.floor(Math.random()*(i+1));[arr[i],arr[j]]=[arr[j],arr[i]]}return arr}

    function fillGrid(grid){
      for(let r=0;r<N;r++){
        for(let c=0;c<N;c++){
          if(grid[r][c]===0){
            const vals = shuffle(Array.from({length:N},(_,i)=>i+1));
            for(const v of vals){
              if(isSafe(grid,r,c,v)){
                grid[r][c]=v;
                if(fillGrid(grid)) return true;
                grid[r][c]=0;
              }
            }
            return false;
          }
        }
      }
      return true;
    }

    function countSolutions(grid, limit=2){
      let count=0;
      function dfs(g){
        if(count>=limit) return;
        let found=false; let rr=-1,cc=-1;
        for(let i=0;i<N;i++){for(let j=0;j<N;j++){if(g[i][j]===0){found=true; rr=i; cc=j; break;}} if(found) break}
        if(!found){count++; return}
        for(let v=1;v<=N;v++){
          if(isSafe(g,rr,cc,v)){
            g[rr][cc]=v; dfs(g); g[rr][cc]=0; if(count>=limit) return;
          }
        }
      }
      const copy = grid.map(r=>r.slice()); dfs(copy); return count;
    }

    function makePuzzle(full, empties){
      const grid = full.map(r=>r.slice());
      const coords = [];
      for(let i=0;i<N;i++) for(let j=0;j<N;j++) coords.push([i,j]);
      shuffle(coords);
      let removed=0;
      for(const [r,c] of coords){
        if(removed>=empties) break;
        const backup = grid[r][c]; grid[r][c]=0;
        if(countSolutions(grid,2)===1){ removed++; } else { grid[r][c]=backup }
      }
      return grid;
    }

    function generate(){
      messageContainer.textContent = '';
      newGameAfterWin.style.display = 'none';

      N = parseInt(sizeSelect.value,10);
      document.documentElement.style.setProperty('--n',N);
      const full = makeEmpty(N);
      fillGrid(full);
      solution = full.map(r=>r.slice());
      const diff = parseInt(difficulty.value,10);
      const maxEmpties = Math.floor(N*N * (0.25 + diff*0.12));
      const puzzle = makePuzzle(full, maxEmpties);
      board = puzzle;
      render();
    }

    function render(){
      boardContainer.innerHTML='';
      const wrap = document.createElement('div');
      wrap.className='board';
      wrap.style.setProperty('--n',N);
      wrap.dataset.n = N;
      wrap.style.width = 'var(--size)';
      wrap.style.height = 'var(--size)';
      wrap.style.gridTemplateColumns = `repeat(${N}, 1fr)`;
      for(let r=0;r<N;r++){
        for(let c=0;c<N;c++){
          const v = board[r][c];
          const cell = document.createElement('div');
          cell.className='cell';
          if(v===0){
            cell.classList.add('empty');
            cell.textContent='';
            cell.addEventListener('click',()=>onCellClick(r,c,cell));
          }
          else{
            cell.classList.add('fixed');
            cell.textContent=displayValue(v);
          }
          wrap.appendChild(cell);
        }
      }
      boardContainer.appendChild(wrap);
    }

    function displayValue(v){
      if((N<=5) && symbolMode.value==='fruits'){
        return fruits[v-1] || String(v);
      }
      return String(v);
    }

    function onCellClick(r,c,cell){
      const current = board[r][c];
      const next = (current % N) + 1;
      board[r][c] = next;
      cell.textContent = displayValue(next);
      if(validateBoard()){
        onWin();
      }
    }

    function validateBoard(){
      for(let i=0;i<N;i++){
        const seenRow = new Set(); const seenCol = new Set();
        for(let j=0;j<N;j++){
          if(board[i][j]===0) return false; if(seenRow.has(board[i][j])) return false; seenRow.add(board[i][j]);
          if(board[j][i]===0) return false; if(seenCol.has(board[j][i])) return false; seenCol.add(board[j][i]);
        }
      }
      const [br, bc] = blockShape(N);
      for(let rs=0; rs<N; rs+=br){
        for(let cs=0; cs<N; cs+=bc){
          const seen = new Set();
          for(let r=0;r<br;r++) for(let c=0;c<bc;c++){
            const v = board[rs+r][cs+c]; if(v===0) return false; if(seen.has(v)) return false; seen.add(v);
          }
        }
      }
      return true;
    }

    function onWin(){
      messageContainer.textContent = '–ú–æ–ª–æ–¥–µ—Ü! üéâ';
      newGameAfterWin.style.display = 'block';

      // –ê–≤—Ç–æ—É–≤–µ–ª–∏—á–µ–Ω–∏–µ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏/—Ä–∞–∑–º–µ—Ä–∞
      let diff = parseInt(difficulty.value,10);
      let size = parseInt(sizeSelect.value,10);

      if(diff < 5){
        difficulty.value = diff + 1;
      } else if(size < 10){
        sizeSelect.value = size + 1;
        difficulty.value = 1;
      } else {
        // –º–∞–∫—Å–∏–º—É–º –¥–æ—Å—Ç–∏–≥–Ω—É—Ç, —Å–±—Ä–æ—Å
        sizeSelect.value = 2;
        difficulty.value = 1;
      }
    }

    newBtn.addEventListener('click', ()=>{ 
      messageContainer.textContent = ''; 
      newGameAfterWin.style.display = 'none'; 
      generate(); 
    });

    solveBtn.addEventListener('click', ()=>{ 
      messageContainer.textContent = ''; 
      newGameAfterWin.style.display = 'none'; 
      board = solution.map(r=>r.slice()); 
      render(); 
    });

    newGameAfterWin.addEventListener('click', ()=>{
      messageContainer.textContent = ''; 
      newGameAfterWin.style.display = 'none'; 
      generate();
    });

    generate();
  </script>
</body>
</html>
